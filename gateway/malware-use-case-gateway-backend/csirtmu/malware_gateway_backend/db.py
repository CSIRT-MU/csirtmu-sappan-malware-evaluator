from typing import Tuple, Optional

from sqlalchemy import create_engine
from sqlalchemy.engine import Engine
from sqlalchemy.orm import Session, registry

engine: Optional[Engine] = None
session: Optional[Session] = None
mapper_registry: Optional[registry] = None


def setup_database(con_string: str) -> Tuple[Engine, Session, registry]:
    global engine, session, mapper_registry
    engine = create_engine(con_string)
    session = Session(engine)

    mapper_registry = registry()
    mapper_registry.metadata.drop_all(engine)

    return engine, session, mapper_registry
