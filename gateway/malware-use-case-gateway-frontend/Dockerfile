FROM node:16.7.0-bullseye-slim

WORKDIR /usr/src/app

ARG REACT_APP_GATEWAY_HOST
ARG REACT_APP_GATEWAY_PORT

ENV REACT_APP_GATEWAY_HOST ${REACT_APP_GATEWAY_HOST}
ENV REACT_APP_GATEWAY_PORT ${REACT_APP_GATEWAY_PORT}

COPY package.json yarn.lock ./

# Sometimes package fetch was too slow, causing timeouts while runnig yarn. Related SO:
# https://stackoverflow.com/questions/51508364/yarn-there-appears-to-be-trouble-with-your-network-connection-retrying
RUN yarn --network-timeout 600000

COPY . ./

RUN yarn build
