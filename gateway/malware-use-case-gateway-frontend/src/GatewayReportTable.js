import './App.css';
import {gql, useQuery} from "@apollo/client";
import {Box, Button, HStack, Table, Tbody, Td, Th, Thead, Tr,} from "@chakra-ui/react";
import {DownloadIcon} from "@chakra-ui/icons";
import {downloadReport} from "./utils";

const GATEWAY_REPORT_LIST = gql`
    query{
        cachedReports {
            key
            etag
            cachedBucket {
                name
            }
        }
    }
`


function GatewayReportTable() {
    const {data, loading, refetch} = useQuery(GATEWAY_REPORT_LIST)

    return (
        <HStack align="start">
        <Table variant="simple" >
            <Thead>
                <Tr>
                    <Th>Report name</Th>
                    <Th>Bucket</Th>
                    <Th isNumeric={true}>Download</Th>
                </Tr>
            </Thead>
            <Tbody>
                {
                    !loading && data && data['cachedReports'].map((item) => (
                        <Tr key={item.key}>
                            <Td>
                                {item.key.length > 35 ? item.key.substring(0, 35) + '...' : item.key}
                            </Td>
                            <Td>
                                {item.cachedBucket.name}
                            </Td>
                            <Td isNumeric={true}>
                                <Box mr={"7"} onClick={() => downloadReport(item.key)}>
                                    <DownloadIcon />
                                </Box>
                            </Td>
                        </Tr>
                    ))
                }
            </Tbody>
        </Table>
        <Button mt={0} size="sm" colorScheme="blue" variant="outline" onClick={() => refetch()}>Refresh</Button>
        </HStack>
    )
}

export default GatewayReportTable
