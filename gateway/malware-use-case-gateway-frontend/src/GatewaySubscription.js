import './App.css';
import {gql, useSubscription} from "@apollo/client";
import {Box, Button, Center, Heading, HStack, Text, VStack} from "@chakra-ui/react";
import React from "react";
import {downloadReport} from "./utils";


const GATEWAY_SUBSCRIPTION = gql`
    subscription($reportName: String){
      minio(reportName: $reportName)
    }`;



function GatewaySubscription(props) {
    const {loading} = useSubscription(GATEWAY_SUBSCRIPTION, {variables: {reportName: props.reportName}});

    const reportClosed = () =>{
        props.reportClosed();
    }

    return (
        <Box mt={5}>
                {loading ? (
                    <Heading>Waiting for analysis to finish...</Heading>
                ) : (
                    <Box>
                        <Center>
                            <Heading>Report is ready</Heading>
                        </Center>
                        <VStack mt={100}>
                            <Text fontSize="3xl">{props.reportName}</Text>
                            <HStack mt={10}>
                                <Button size="md" colorScheme="blue" variant="solid" onClick={() => downloadReport(props.reportName)}>Download</Button>
                                <Button size="md" colorScheme="blue" variant="outline" onClick={() => reportClosed()}>New upload</Button>
                            </HStack>
                        </VStack>
                    </Box>
                )}
        </Box>
    );
}
export default GatewaySubscription;
