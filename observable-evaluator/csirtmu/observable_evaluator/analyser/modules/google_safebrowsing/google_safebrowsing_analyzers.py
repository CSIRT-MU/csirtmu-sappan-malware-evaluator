from csirtmu.observable_evaluator.analyser.intel_owl_report import IntelOwlReport
from csirtmu.observable_evaluator.analyser.abstract_analysers import AbstractObservableAnalyser
from csirtmu.observable_evaluator.analyser.analysis_result import ObservableAnalysis

from .reports.google_safebrowsing_report import GoogleSafebrowsingReport


class GoogleSafebrowsingObservableAnalyser(AbstractObservableAnalyser):

    def analyse(self, intelowl_report: IntelOwlReport[GoogleSafebrowsingReport], **kwargs) -> ObservableAnalysis:
        analysis = {
            "malicious": intelowl_report.report.malicious,
            "observable": intelowl_report.report.observable,
            "score": 100 if intelowl_report.report.malicious else 0,
        }

        if kwargs.get("raw", False):
            analysis["raw"] = intelowl_report

        if detected := kwargs.get("detected", None):
            analysis['detected'] = detected

        return ObservableAnalysis(**analysis)
