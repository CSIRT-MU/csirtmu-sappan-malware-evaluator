from airflow.models import BaseOperator
from airflow.utils.decorators import apply_defaults
from pathlib import Path
from hooks.observable_evaluator.observable_evaluator_hook import ObservableEvaluatorHook


class ObservableEvaluatorAnalyseObservablesOperator(BaseOperator):
    """
    This operator takes observable value and puts it into the Observable Evaluator for observable analysis

    :observable: str = observable value
    :conn_id: str = connection ID of Observable Evaluator Connection
    """

    template_fields = ('observable', 'conn_id')

    @apply_defaults
    def __init__(self,
                 observable,
                 conn_id='',
                 *args,
                 **kwargs):

        super().__init__(*args, **kwargs)
        self.observable = observable
        self.conn_id = conn_id

    def execute(self, context):
        hook = ObservableEvaluatorHook(self.conn_id)
        response = hook.send_observables_for_analysis(self.observable)
        # we are working with single observable
        return response.json()[0]
