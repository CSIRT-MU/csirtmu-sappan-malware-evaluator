#!/bin/bash

S3_SECRET_KEY=minioadmin
S3_KEY_ID=minioadmin
INTEL_OWL_KEY=11235813213455891442333776109870
MISP_LOCAL_KEY=2n3i0IoEcwg9K1sAbhaaZKQqZTaNuCfaYGoCmodG

blocker=(blocker_conn_id http://blockers:8080/api) 
dnsrpz=(dnsrpz_conn_id http://dnsrpz:8080/api) 
whitelist=(whitelist_conn_id http://whitelist:8080/api)
s3=(s3_conn_id "s3://${S3_KEY_ID}:${S3_SECRET_KEY}@minio:9000?host=http://minio:9000")
observable_evaluator=("observable_evaluator_conn_id" "http://observable-evaluator:8000")
misp_local=("misp_local_conn_id" "http://:${MISP_LOCAL_KEY}@misp:80")
postgres_netflow=("postgres_netflow_conn" "postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOSTNAME}/${NETFLOW_DBNAME}")

CONNECTIONS=(blocker dnsrpz whitelist s3 observable_evaluator misp_local postgres_netflow)

declare -n CONNECTION

for CONNECTION in "${CONNECTIONS[@]}"; do 
    airflow connections delete ${CONNECTION[0]} 2>/dev/null
    airflow connections add ${CONNECTION[0]} --conn-uri  ${CONNECTION[1]}
done
