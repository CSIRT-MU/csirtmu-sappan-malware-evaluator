#!/usr/bin/python
import psycopg2
import os
import sys
from time import sleep
tries = 5
wait = 5
counter = 0

DBNAME = os.getenv('INTELOWL_DBNAME')
DBHOST = os.getenv('DB_HOST')
DBUSER = os.getenv('DB_USER')
DBPASS = os.getenv('DB_PASSWORD')

while counter < tries:
    try:
        conn = psycopg2.connect(dbname=DBNAME, host=DBHOST, user=DBUSER, password=DBPASS)
        conn.close()
        sys.exit(0)
    except psycopg2.Error as e:
        print(e.pgerror)
        print(e.pgcode)
        print(e)
        print("Waiting for database, try: " + str(counter))
        counter+=1
        sleep(wait*counter)
sys.exit(2)
