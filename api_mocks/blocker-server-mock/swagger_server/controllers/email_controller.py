import connexion
import six

from swagger_server.models.email_add_record import EmailAddRecord
from swagger_server.models.email_remove_record import EmailRemoveRecord
from swagger_server.models.email import Email
from swagger_server.models.email_list_success_response import EmailListSuccessResponse
from swagger_server.models.error_response import ErrorResponse
from swagger_server.storage.storage_operator import StorageOperator

from datetime import datetime, timedelta

storage = StorageOperator()


def emails_post(body=None):  # noqa: E501
    """block email

     # noqa: E501

    :param body: 
    :type body: dict | bytes

    :rtype: None
    """
    if connexion.request.is_json:
        body = EmailAddRecord.from_dict(connexion.request.get_json())
        listed = datetime.now()
        expires = None
        if (body.length):
            expires = listed + timedelta(days=body.length)
            expires = expires.strftime("%Y-%m-%dT%H:%M:%S")
        listed_str = listed.strftime("%Y-%m-%dT%H:%M:%S")
        email = Email(email = body.email, reason = body.reason, who = body.who, direction = "both", listed = listed_str, expires = expires)
        storage.ban_email(email)


def emails_put(body=None):  # noqa: E501
    """unblock email

     # noqa: E501

    :param body: 
    :type body: dict | bytes

    :rtype: None
    """
    if connexion.request.is_json:
        body = EmailRemoveRecord.from_dict(connexion.request.get_json())  # noqa: E501
        email=Email(email=body.email)
        storage.unban_email(email)


def list_email():  # noqa: E501
    """Get all blocked e-mail addresses

    Lists all blocked email addresses # noqa: E501


    :rtype: InlineResponse2001
    """
    return storage.get_email_bans()
